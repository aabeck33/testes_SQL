SELECT     GNACT.CDGENACTIVITY,     GNACT.IDACTIVITY,     GNACT.FGSTATUS,     GNACT.FGEXECUTERLOCK,     GNACT.CDUSER,     GNACT.DTSTARTPLAN,     GNACT.DTFINISHPLAN,     GNACT.DTSTART,     GNACT.DTFINISH,     GNCOSTCFG.MNCOSTPROGTEC,     GNCOSTCFG.MNCOSTREALTEC,     GNCOSTCFG.MNCOSTPROGMAT,     GNCOSTCFG.MNCOSTREALMAT,     GNCOSTCFG.MNCOSTPROGASSET,     GNCOSTCFG.MNCOSTREALASSET,     GNCOSTCFG.MNCOSTPROGTASK,     GNCOSTCFG.MNCOSTREALTASK,     GNCOSTCFG.MNCOSTPROGEXTRA,     GNCOSTCFG.MNCOSTREALEXTRA,     GNCOSTCFG.MNCOSTPROG,     GNCOSTCFG.MNCOSTREAL,     CUSTOM_GNACT.FGDEADLINE, 	ASEXECACT.FGACTTYPE, 	OBOBJ.IDOBJECT + ' - ' + OBOBJ.NMOBJECT AS NMOBJECT_FULLNAME,     OBJTYPE.CDOBJECTTYPE,     OBJTYPE.IDOBJECTTYPE + ' - ' + OBJTYPE.NMOBJECTTYPE AS NMOBJECTTYPE_FULLNAME, 	ASAST.CDASSET, 	EXEC_ASPLANACT.CDPLANACTIVITY, 	CASE 		WHEN EXEC_ASPLANACT.CDPLANACTIVITY IS NOT NULL THEN EXEC_ASPLANACT.IDPLANACTIVITY + ' - ' + EXEC_ASPLANACT.NMPLANACTIVITY 		ELSE NULL 	END VIEW_PLANFULLNAME, 	ASACTMODEL.CDACTIVITY CDACTIVITYMODEL, 	CASE 		WHEN ASACTMODEL.CDACTIVITY IS NOT NULL THEN ASACTMODEL.IDACTIVITY + ' - ' + ASACTMODEL.NMACTIVITY 		ELSE NULL 	END VIEW_ACTIVITYMODELFULLNAME,         ASSRVCNTR.CDSERVICECENTER, 	CASE 		WHEN ASSRVCNTR.CDSERVICECENTER IS NOT NULL THEN ASSRVCNTR.IDCOMMERCIAL + ' - ' + ASSRVCNTR.NMCOMPANY 		ELSE NULL 	END NMSERVICECENTER,     GNRV.CDRESOURCE, 	CASE 		WHEN GNRV.IDRESOURCE IS NOT NULL THEN GNRV.IDRESOURCE +' - '+ GNRV.NMRESOURCE 		ELSE '' 	END AS NMRESOURCERESP, 	ALIAS_MAMAINTTYPE.CDMAINTTYPE, 	GNEVRESULTUSED.VLEVALRESULT,     GNEVRESULT.CDEVALRESULT, 	GNEVRESULT.NMEVALRESULT, 	EXEC_ASPLANACT.CDTEAM AS CDPLANTEAM, 	CASE 		WHEN EXEC_ASPLANACT.CDTEAM IS NOT NULL THEN PLANTEAM.IDTEAM + ' - ' + PLANTEAM.NMTEAM 		ELSE NULL 	END AS VIEW_PLANTEAM, 	ASACTMODEL.CDTEAM AS CDEXECTEAM, 	CASE 		WHEN ASACTMODEL.CDTEAM IS NOT NULL THEN EXECTEAM.IDTEAM + ' - ' + EXECTEAM.NMTEAM 		ELSE NULL 	END AS VIEW_EXECTEAM, 	CASE 		WHEN GNACT.QTMINUTESPLAN IS NULL THEN NULL 		WHEN GNACT.QTMINUTESREAL IS NULL THEN NULL 		ELSE (CAST((GNACT.QTMINUTESREAL - GNACT.QTMINUTESPLAN) AS NUMERIC(19)) * 60 * 1000) 	END AS QTMINUTESDIFF_VIEW, 	(CAST(GNACT.QTMINUTESPLAN AS NUMERIC(19)) * 60 * 1000) AS QTMINUTESPLAN_VIEW, 	(CAST(GNACT.QTMINUTESREAL AS NUMERIC(19)) * 60 * 1000) AS QTMINUTESREAL_VIEW, 	(CAST(GNACT.QTTIMESTARTPLAN AS NUMERIC(19)) * 60 * 1000) AS QTTIMESTARTPLAN_VIEW, 	(CAST(GNACT.QTTIMEFINISHPLAN AS NUMERIC(19)) * 60 * 1000) AS QTTIMEFINISHPLAN_VIEW, 	(CAST(GNACT.QTTIMESTART AS NUMERIC(19)) * 60 * 1000) AS QTTIMESTART_VIEW, 	(CAST(GNACT.QTTIMEFINISH AS NUMERIC(19)) * 60 * 1000) AS QTTIMEFINISH_VIEW,     AS_SITE.CDSITE, 	(         CASE         WHEN AS_SITE.CDSITE IS NOT NULL THEN '#{100358}: ' + AS_SITE.IDSITE + ' - ' + AS_SITE.NMSITE         ELSE ''         END         +         CASE         WHEN  AD_USER.CDUSER IS NOT NULL AND AS_SITE.CDSITE IS NOT NULL THEN ' | #{100044}: ' + AD_USER.IDUSER + ' - ' + AD_USER.NMUSER         WHEN  AD_USER.CDUSER IS NOT NULL THEN '#{100044}: ' + AD_USER.IDUSER + ' - ' + AD_USER.NMUSER         ELSE ''         END     ) AS NMLOCATION_FULLNAME,     AS_STATE.CDSTATE,     CASE         WHEN AS_STATE.CDSTATE IS NOT NULL THEN AS_STATE.IDSTATE + ' - ' + AS_STATE.NMSTATE         ELSE ''     END AS NMSTATE_FULLNAME,     MANUFACTURER.CDCOMPANY CDMANUFACTURER,     CASE         WHEN MANUFACTURER.CDCOMPANY IS NOT NULL THEN MANUFACTURER.NMCOMPANY + ' - ' + MANUFACTURER.IDCOMMERCIAL         ELSE ''     END AS NMMAN_FULLNAME,     SUPPLIER.CDCOMPANY CDSUPPLIER,     CASE         WHEN SUPPLIER.CDCOMPANY IS NOT NULL THEN SUPPLIER.NMCOMPANY + ' - ' + SUPPLIER.IDCOMMERCIAL         ELSE ''     END AS NMSUPPLIER_FULLNAME,     CASE         WHEN GNACT.CDUSER IS NOT NULL THEN         CASE GNACT.FGEXECUTERLOCK             WHEN 1 THEN '#{219011}'             WHEN 2 THEN '#{108527}'         END         ELSE '#{214111}'     END AS NMRESPONSIBLETYPE,     (SELECT IDUSER + ' - ' + NMUSER FROM ADUSER WHERE CDUSER = GNACT.CDUSER) AS NMEXECUTOR,     SEDESC.TXDATA AS DESCRICAO_TEXTO_CRU,     SEACTT.TXDATA AS ACAO_TOMADA_TEXTO_CRU,     CASE         WHEN ALIAS_MAMAINTTYPE.IDMAINTTYPE IS NULL THEN '#{216712}'         ELSE ALIAS_MAMAINTTYPE.IDMAINTTYPE + ' - ' + ALIAS_MAMAINTTYPE.NMMAINTTYPE     END AS VIEW_MAINTTYPE,     CASE CUSTOM_GNACT.FGDEADLINE         WHEN 1 THEN '#{100900}'         WHEN 2 THEN '#{111460}'         WHEN 3 THEN '#{100899}'         ELSE '#{102295}'     END AS NMDEADLINE,     CASE         WHEN GNACT.FGSTATUS = 1 THEN '#{100470}'         WHEN GNACT.FGSTATUS = 2 THEN '#{107047}'         WHEN GNACT.FGSTATUS = 13 THEN '#{104919}'         WHEN GNACT.FGSTATUS = 3 THEN '#{200002}'         WHEN GNACT.FGSTATUS = 4 THEN '#{112685}'         WHEN GNACT.FGSTATUS = 5 THEN '#{101237}'         WHEN GNACT.FGSTATUS = 6 THEN '#{102338}'         WHEN GNACT.FGSTATUS = 8 THEN '#{207816}'     END AS NMSTATUS,     CASE         WHEN ASEXECACT.FGACTTYPE = 1 THEN '#{100303}'         WHEN ASEXECACT.FGACTTYPE = 2 THEN '#{200144}'         WHEN ASEXECACT.FGACTTYPE = 3 THEN '#{101556}'         WHEN ASEXECACT.FGACTTYPE = 6 THEN '#{103931}'         WHEN ASEXECACT.FGACTTYPE = 7 THEN '#{207918}'         WHEN ASEXECACT.FGACTTYPE = 8 THEN '#{207917}'     END AS NMACTTYPE,     OBDEF.CDDEFECT,     CASE         WHEN OBDEF.CDDEFECT IS NULL THEN NULL         ELSE OBDEF.IDDEFECT + ' - ' + OBDEF.NMDEFECT     END AS NMDEFECT_FULLNAME,     OBCAU.CDCAUSE,     CASE         WHEN OBCAU.CDCAUSE IS NULL THEN NULL         ELSE OBCAU.IDCAUSE + ' - ' + OBCAU.NMCAUSE     END AS NMCAUSE_FULLNAME              FROM 	GNACTIVITY GNACT     INNER JOIN (  		SELECT 			TEMP_ACT.CDGENACTIVITY, 			CASE 				WHEN TEMP_ACT.FGSTATUS = 1 OR TEMP_ACT.FGSTATUS = 2 THEN 					CASE 						WHEN (TEMP_ACT.DTSTARTPLAN IS NOT NULL AND TEMP_ACT.DTSTARTPLAN < <!%TODAY%>) THEN 3 						WHEN (TEMP_ACT.DTSTARTPLAN IS NULL OR TEMP_ACT.DTSTARTPLAN >= <!%TODAY%>) THEN 1 					END 				WHEN TEMP_ACT.FGSTATUS = 3 OR TEMP_ACT.FGSTATUS = 13 THEN 					CASE 						WHEN (TEMP_ACT.DTSTART IS NULL) THEN 							CASE 								WHEN (TEMP_ACT.DTSTARTPLAN < <!%TODAY%>) THEN 3 								WHEN (TEMP_ACT.DTSTARTPLAN > <!%TODAY%>) THEN 1 								ELSE 2 							END 						WHEN (TEMP_ACT.DTSTART IS NOT NULL AND TEMP_ACT.DTFINISH IS NULL) THEN 							CASE 								WHEN (TEMP_ACT.DTFINISHPLAN < <!%TODAY%>) THEN 3 								WHEN (TEMP_ACT.DTFINISHPLAN > <!%TODAY%>) THEN 1 								ELSE 2 							END 						WHEN (TEMP_ACT.DTSTART IS NOT NULL AND TEMP_ACT.DTFINISH IS NOT NULL) THEN 							CASE 								WHEN (TEMP_ACT.DTFINISHPLAN IS NOT NULL AND TEMP_ACT.DTFINISH <= TEMP_ACT.DTFINISHPLAN) THEN 1 								WHEN (TEMP_ACT.DTFINISHPLAN IS NOT NULL AND TEMP_ACT.DTFINISH > TEMP_ACT.DTFINISHPLAN) THEN 3 								ELSE 2 							END 					END 				WHEN TEMP_ACT.FGSTATUS = 5 OR TEMP_ACT.FGSTATUS = 4 THEN 					CASE 						WHEN (TEMP_ACT.DTSTARTPLAN IS NULL OR TEMP_ACT.DTFINISH <= TEMP_ACT.DTFINISHPLAN) THEN 1 						ELSE 3 					END 			END  FGDEADLINE			 		FROM 			GNACTIVITY TEMP_ACT     ) CUSTOM_GNACT  ON ( CUSTOM_GNACT.CDGENACTIVITY = GNACT.CDGENACTIVITY )     INNER JOIN GNCOSTCONFIG GNCOSTCFG  ON ( GNCOSTCFG.CDCOSTCONFIG = GNACT.CDCOSTCONFIG )     LEFT JOIN GNEVALRESULTUSED GNEVRESULTUSED  ON ( GNEVRESULTUSED.CDEVALRESULTUSED = GNACT.CDEVALRSLTPRIORITY )     LEFT JOIN GNEVALRESULT GNEVRESULT  ON ( GNEVRESULT.CDEVALRESULT = GNEVRESULTUSED.CDEVALRESULT )     INNER JOIN ASEXECACTIVITY ASEXECACT  ON ( ASEXECACT.CDGENACTIVITY = GNACT.CDGENACTIVITY )     LEFT JOIN ASPLANACTIVITY EXEC_ASPLANACT  ON ( EXEC_ASPLANACT.CDPLANACTIVITY = ASEXECACT.CDPLANNING )     INNER JOIN ASACTIVITY ASACTMODEL  ON ( ASACTMODEL.CDACTIVITY = ASEXECACT.CDACTIVITY )     LEFT JOIN ASEXECACTIVASSET ASEXECACTAST  ON ( ASEXECACT.CDEXECACTIVITY = ASEXECACTAST. CDEXECACTIVITY   )     LEFT JOIN OBOBJECT OBOBJ  ON ( ASEXECACTAST.CDASSET = OBOBJ.CDOBJECT AND OBOBJ.FGCURRENT = 1 )     LEFT JOIN OBOBJECTGROUP OBJGRP  ON ( OBJGRP.CDOBJECTGROUP = OBOBJ.CDOBJECT )     LEFT JOIN OBOBJECTTYPE OBJTYPE  ON ( OBJTYPE.CDOBJECTTYPE = OBJGRP.CDOBJECTTYPE )     LEFT JOIN ASASSET ASAST  ON ( OBOBJ.CDREVISION = ASAST.CDREVISION AND ASEXECACTAST.CDASSET = ASAST.CDASSET )     LEFT JOIN ASSERVICECENTER ASSRVCNTR  ON ( ASSRVCNTR.CDSERVICECENTER = ASEXECACT.CDSERVICECENTERE )     LEFT JOIN GNRESOURCEVIEW GNRV  ON ( GNRV.CDRESOURCE = ASEXECACT.CDRESOURCERESP )     LEFT JOIN ADTEAM PLANTEAM  ON ( EXEC_ASPLANACT.CDTEAM = PLANTEAM.CDTEAM )     LEFT JOIN ADTEAM EXECTEAM  ON ( ASACTMODEL.CDTEAM = EXECTEAM.CDTEAM ) 	LEFT JOIN MAMAINTTYPE ALIAS_MAMAINTTYPE  ON ( ALIAS_MAMAINTTYPE.CDMAINTTYPE = ASEXECACT.CDACTIVCLASS ) 	LEFT JOIN ASHISTASSETSITE ASHISTSITE ON (ASHISTSITE.CDASSET = ASAST.CDASSET AND ASHISTSITE.CDREVISION = ASAST.CDREVISION)     LEFT JOIN ASSITE AS_SITE ON (AS_SITE.CDSITE = ASHISTSITE.CDSITE)     LEFT JOIN ADUSER AD_USER ON (AD_USER.CDUSER = ASHISTSITE.CDUSERSITE)     LEFT JOIN ASHISTASSETSTATE ASHISTSTATE ON (ASHISTSTATE.CDASSET = ASAST.CDASSET AND ASHISTSTATE.CDREVISION = ASAST.CDREVISION)     LEFT JOIN ASSTATE AS_STATE ON (AS_STATE.CDSTATE = ASHISTSTATE.CDSTATE)     LEFT JOIN ADCOMPANY MANUFACTURER ON (MANUFACTURER.CDCOMPANY = ASAST.CDMANUFACTURER)     LEFT JOIN ADCOMPANY SUPPLIER ON (SUPPLIER.CDCOMPANY = ASAST.CDSUPPLIER)     LEFT JOIN SERICHTEXT SERICHDESC  ON (SERICHDESC.OID = GNACT.OIDDESCRIPTION)     LEFT JOIN SERICHTEXT SERICHACTT  ON (SERICHACTT.OID = GNACT.OIDACTIONTAKEN)     LEFT JOIN SETEXT SEDESC ON (SEDESC.OID = SERICHDESC.OIDTEXTCONTENT)     LEFT JOIN SETEXT SEACTT ON (SEACTT.OID = SERICHACTT.OIDTEXTCONTENT)     LEFT JOIN ASEXECACTIVITYDEF ASEXECACTDEF ON (ASEXECACTAST.CDEXECACTIVASSET = ASEXECACTDEF.CDEXECACTIVASSET)     LEFT JOIN OBDEFECT OBDEF ON (ASEXECACTDEF.CDDEFECT = OBDEF.CDDEFECT)     LEFT JOIN ASEXECACTIVDEFCAU ASEXECACTDEFCAU ON (ASEXECACTDEF.CDEXECACTIVITDEF = ASEXECACTDEFCAU.CDEXECACTIVITYDEF)     LEFT JOIN OBCAUSE OBCAU ON (ASEXECACTDEFCAU.CDCAUSE = OBCAU.CDCAUSE) WHERE       EXISTS ( 		SELECT 			1 		FROM 			ASEXECACTIVASSET CHKEXECACTAST 				INNER JOIN OBOBJECTGROUP CHKOBJGRP ON ( CHKEXECACTAST.CDASSET = CHKOBJGRP.CDOBJECTGROUP ) 				INNER JOIN OBOBJECTTYPE CHKOBJTYPE ON ( CHKOBJGRP.CDOBJECTTYPE = CHKOBJTYPE.CDOBJECTTYPE ) 				INNER JOIN ( 					SELECT 						MAX(CHKUSRPERMTYPEROLE.FGPERMISSIONTYPE) AS FGACCESSLIST, 						CHKUSRPERMTYPEROLE.CDTYPEROLE AS CDTYPEROLE 					FROM 						GNUSERPERMTYPEROLE CHKUSRPERMTYPEROLE 					WHERE 						CHKUSRPERMTYPEROLE.CDPERMISSION = 5 						AND ( 							CHKUSRPERMTYPEROLE.CDUSER = -1 							OR CHKUSRPERMTYPEROLE.CDUSER = <!%CDUSER%> 						) 					GROUP BY 						CHKUSRPERMTYPEROLE.CDTYPEROLE 				) ASSETPERMLIST ON ( CHKOBJTYPE.CDTYPEROLE = ASSETPERMLIST.CDTYPEROLE AND ASSETPERMLIST.FGACCESSLIST = 1 ) 		WHERE 			ASEXECACT.CDEXECACTIVITY = CHKEXECACTAST.CDEXECACTIVITY     )     AND EXISTS ( 		SELECT 			1 		FROM 			ASEXECACTIVASSET CHKEXECACT 			INNER JOIN ASASSET CHKAST ON (CHKAST.CDASSET = CHKEXECACT.CDASSET) 			INNER JOIN OBOBJECT CHKOBJ ON (CHKOBJ.CDOBJECT = CHKAST.CDASSET AND CHKOBJ.CDREVISION = CHKAST.CDREVISION) 			INNER JOIN OBOBJECTGROUP CHKOBJGRP ON (CHKOBJGRP.CDOBJECTGROUP = CHKOBJ.CDOBJECT) 			INNER JOIN OBOBJECTTYPE CHKOBJTYPE ON (CHKOBJTYPE.CDOBJECTTYPE = CHKOBJGRP.CDOBJECTTYPE) 		WHERE 			CHKEXECACT.CDEXECACTIVITY = ASEXECACT.CDEXECACTIVITY 				AND CHKOBJ.FGCURRENT = 1 					AND CHKAST.FGASSTATUS <> 4     )