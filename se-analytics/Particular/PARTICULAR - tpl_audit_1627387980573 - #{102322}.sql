SELECT 1 AS QTDE, COUNT(DISTINCT CODE) AS CNT, NMOBJECT, NMDEADLINEOCCUR, FGDEADLINEOCCUR FROM ( SELECT RN.NRSEQNC AS CODE, '#{100482}' AS NMOBJECT, CASE WHEN (RN.CDSITUACAO = 9 OR (RN.IDPENDEQUIPE = 1 AND TBDEADLINE.DTPRAZO IS NULL) OR (RN.CDSITUACAO = 1 AND RN.CDSITESTADO = 1)) THEN 4 WHEN ((TBDEADLINE.DTPRAZO < GETDATE()) OR (TBDEADLINE.DTPRAZO IS NULL)) THEN 3 WHEN (TBDEADLINE.DTPRAZO > CAST(AUXDTDEADLINE.DTDEADLINE AS DATETIME)) THEN 1 ELSE 2 END AS FGDEADLINEOCCUR, CASE WHEN (RN.CDSITUACAO = 9 OR (RN.IDPENDEQUIPE = 1 AND TBDEADLINE.DTPRAZO IS NULL) OR (RN.CDSITUACAO = 1 AND RN.CDSITESTADO = 1)) THEN '#{100900}' WHEN ((TBDEADLINE.DTPRAZO < GETDATE()) OR (TBDEADLINE.DTPRAZO IS NULL)) THEN '#{100899}' WHEN (TBDEADLINE.DTPRAZO > CAST(AUXDTDEADLINE.DTDEADLINE AS DATETIME)) THEN '#{100900}' ELSE '#{201639}' END AS NMDEADLINEOCCUR, AU.CDAUDIT FROM AUAUDIT AU INNER JOIN AUAUDITTYPE AUTP ON (AU.CDAUDITTYPE = AUTP.CDAUDITTYPE) INNER JOIN AUSCOPESTRUCT ON AU.CDSCOPEDEFINITION = AUSCOPESTRUCT.CDSCOPEDEFINITION INNER JOIN GNASSOCACTION GNACT ON AUSCOPESTRUCT.CDASSOC = GNACT.CDASSOC INNER JOIN RNC RN ON RN.NRSEQNC = GNACT.CDACTION INNER JOIN CLASSIF CLOC ON RN.CDCLASSIF = CLOC.CDCLASSIF INNER JOIN ADDEPARTMENT ADPT2 ON RN.CDAREANC = ADPT2.CDDEPARTMENT INNER JOIN SITUACAO STOC ON RN.CDSITUACAO = STOC.CDFASE AND RN.CDSITESTADO = STOC.CDESTADO LEFT OUTER JOIN ( SELECT TB1.NRSEQNC, MIN(TB1.DTPRAZO) AS DTPRAZO FROM ( SELECT RN.NRSEQNC, NULL AS DTPRAZO FROM RNC RN INNER JOIN GNASSOCACTION GNAA ON (RN.NRSEQNC = GNAA.CDACTION) WHERE RN.CDSITUACAO = 1 AND RN.CDSITESTADO = 1 UNION ALL SELECT RN.NRSEQNC, RNA.DTPRAZO FROM RNC RN INNER JOIN GNASSOCACTION GNAA ON (RN.NRSEQNC = GNAA.CDACTION) INNER JOIN RNCEQAPROVADOR RNA ON RN.NRSEQNC = RNA.NRSEQNC INNER JOIN RNCMETODO RNM ON RNA.NRSEQNC = RNM.NRSEQNC AND RNA.CDFASE = RNM.CDFASE AND RNA.NRCYCLE = RNM.NRCYCLE WHERE ((RN.CDSITUACAO < 8 AND RN.CDSITESTADO = 2 AND RNA.CDFASE = RN.CDSITUACAO) OR (RN.CDSITUACAO <> 10 AND RN.IDDISP = 6 AND RNA.CDFASE = 2)) AND RNA.NRSEQAPROVADOR = ( SELECT MIN(ER.NRSEQAPROVADOR) FROM RNCEQAPROVADOR ER WHERE ER.NRSEQNC = RN.NRSEQNC AND ER.CDFASE = RNA.CDFASE AND ER.NRCYCLE = RNA.NRCYCLE AND ER.IDAPROVADO NOT IN (1, 2)) UNION ALL SELECT RN.NRSEQNC, RE.DTPRAZOELAB FROM RNC RN INNER JOIN GNASSOCACTION GNAA ON (RN.NRSEQNC = GNAA.CDACTION) INNER JOIN RNCEQUIPE RE ON RN.NRSEQNC = RE.NRSEQNC WHERE (RN.IDDISP = 4 AND RN.CDSITUACAO <> 10 AND RE.CDFASE = 2) OR (RN.CDSITESTADO = 1 AND (RN.CDSITUACAO = 3 OR RN.CDSITUACAO = 5 OR RN.CDSITUACAO = 7) AND RE.CDFASE = RN.CDSITUACAO) UNION ALL SELECT RN.NRSEQNC, AC.DTFIMPREV FROM RNC RN INNER JOIN GNASSOCACTION GNAA ON (RN.NRSEQNC = GNAA.CDACTION) INNER JOIN ACAO AC ON RN.NRSEQNC = AC.NRSEQNC WHERE AC.CDSITACAO = 2 AND ((RN.CDSITESTADO = 3 AND ((RN.CDSITUACAO = 3 AND AC.CDFASEACAO = 2) OR (RN.CDSITUACAO = 5 AND AC.CDFASEACAO = 3) OR (RN.CDSITUACAO = 7 AND AC.CDFASEACAO = 4))) OR (RN.CDSITUACAO <> 10 AND AC.CDFASEACAO = 1)) UNION ALL SELECT RN.NRSEQNC, AC.DTPRAZOVERIFACAO FROM RNC RN INNER JOIN GNASSOCACTION GNAA ON (RN.NRSEQNC = GNAA.CDACTION) INNER JOIN ACAO AC ON RN.NRSEQNC = AC.NRSEQNC WHERE AC.CDSITACAO = 3 AND ((RN.CDSITESTADO = 3 AND ((RN.CDSITUACAO = 3 AND AC.CDFASEACAO = 2) OR (RN.CDSITUACAO = 5 AND AC.CDFASEACAO = 3) OR (RN.CDSITUACAO = 7 AND AC.CDFASEACAO = 4))) OR (RN.CDSITUACAO <> 10 AND AC.CDFASEACAO = 1)) UNION ALL SELECT RN.NRSEQNC, EA.DTPRAZO FROM RNC RN INNER JOIN GNASSOCACTION GNAA ON (RN.NRSEQNC = GNAA.CDACTION) INNER JOIN RNCEQANALISTA EA ON RN.NRSEQNC = EA.NRSEQNC WHERE EA.NRSEQANALISTA = ( SELECT MIN(NRSEQANALISTA) FROM RNCEQANALISTA WHERE NRSEQNC = RN.NRSEQNC AND DTANALISE IS NULL) AND RN.CDSITUACAO = 4 AND RN.CDSITESTADO = 1 UNION ALL SELECT RN.NRSEQNC, RE.DTPRAZOVERIF FROM RNC RN INNER JOIN GNASSOCACTION GNAA ON (RN.NRSEQNC = GNAA.CDACTION) INNER JOIN RNCEQUIPE RE ON RN.NRSEQNC = RE.NRSEQNC AND RE.CDFASE = RN.CDSITUACAO WHERE RN.CDSITESTADO = 1 AND (RN.CDSITUACAO = 6 OR RN.CDSITUACAO = 8) ) TB1 GROUP BY TB1.NRSEQNC) TBDEADLINE ON (TBDEADLINE.NRSEQNC = RN.NRSEQNC) CROSS JOIN ( SELECT CASE COALESCE(ADPARAMS.VLPARAM, 0) WHEN 0 THEN GETDATE() ELSE MAX(TB.ENDDATE) END AS DTDEADLINE FROM ADPARAMS INNER JOIN ( SELECT DATEADD(MINUTE, GNCARTPRODUCT.CDNUMBER * 1440, GETDATE()) AS ENDDATE, ROW_NUMBER() OVER ( ORDER BY GNCARTPRODUCT.CDNUMBER) AS RNUM, GNCARTPRODUCT.CDNUMBER FROM GNCARTPRODUCT WHERE DATEPART(DW, DATEADD(MINUTE, GNCARTPRODUCT.CDNUMBER * 1440, GETDATE())) NOT IN (DATEPART(DW, CONVERT(DATETIME, CAST(9 AS VARCHAR)+ '/' + CAST(9 AS VARCHAR)+ '/' + CAST(2017 AS VARCHAR), 103)), DATEPART(DW, CONVERT(DATETIME, CAST(1 AS VARCHAR)+ '/' + CAST(1 AS VARCHAR)+ '/' + CAST(2017 AS VARCHAR), 103))) AND GNCARTPRODUCT.CDNUMBER < 13000 ) TB ON TB.RNUM = ADPARAMS.VLPARAM WHERE ADPARAMS.CDISOSYSTEM = 2 AND ADPARAMS.CDPARAM = 3 GROUP BY ADPARAMS.VLPARAM) AUXDTDEADLINE WHERE AU.FGOCCURMONITORING = 1 AND AU.FGAUDITSTATUS = 56 AND STOC.CDFASE NOT IN (9, 10) AND EXISTS( SELECT 1 FROM ADTEAMUSER WHERE ADTEAMUSER.CDUSER = <!%CDUSER%> AND ADTEAMUSER.CDTEAM = AU.CDOCCURMONITTEAM ) UNION SELECT P.CDPROCESS AS CODE, CASE WHEN(INOCCUR.FGOCCURRENCETYPE = 1) THEN '#{107063}' WHEN(INOCCUR.FGOCCURRENCETYPE = 2) THEN '#{200745}' END AS NMOBJECT, CASE WHEN P.FGCONCLUDEDSTATUS = 2 THEN 3 WHEN P.FGCONCLUDEDSTATUS = 1 THEN 1 WHEN ((P.DTESTIMATEDFINISH > (DATEADD(DAY, COALESCE(AUXADMAILTASKEXEC.QTDAYS, 1), GETDATE()))) OR (P.DTESTIMATEDFINISH IS NULL)) THEN 1 WHEN ((P.DTESTIMATEDFINISH = GETDATE() AND P.NRTIMEESTFINISH > 860) OR (P.DTESTIMATEDFINISH > GETDATE())) THEN 2 ELSE 3 END AS FGDEADLINEOCCUR, CASE WHEN P.FGCONCLUDEDSTATUS = 2 THEN '#{100899}' WHEN P.FGCONCLUDEDSTATUS = 1 THEN '#{100900}' WHEN ((P.DTESTIMATEDFINISH > (DATEADD(DAY, COALESCE(AUXADMAILTASKEXEC.QTDAYS, 1), GETDATE()))) OR (P.DTESTIMATEDFINISH IS NULL)) THEN '#{100900}' WHEN ((P.DTESTIMATEDFINISH = GETDATE() AND P.NRTIMEESTFINISH > 860) OR (P.DTESTIMATEDFINISH > GETDATE())) THEN '#{201639}' ELSE '#{100899}' END AS NMDEADLINEOCCUR, AU.CDAUDIT FROM AUAUDIT AU INNER JOIN AUAUDITTYPE AUTP ON (AU.CDAUDITTYPE = AUTP.CDAUDITTYPE) INNER JOIN AUSCOPESTRUCT ON AU.CDSCOPEDEFINITION = AUSCOPESTRUCT.CDSCOPEDEFINITION INNER JOIN GNASSOCWORKFLOW GNWF ON AUSCOPESTRUCT.CDASSOC = GNWF.CDASSOC INNER JOIN WFPROCESS P ON (GNWF.IDPROCESS = P.IDOBJECT) INNER JOIN INOCCURRENCE INOCCUR ON (INOCCUR.IDWORKFLOW = P.IDOBJECT) INNER JOIN GNGENTYPE GNT ON (INOCCUR.CDOCCURRENCETYPE = GNT.CDGENTYPE) INNER JOIN ADTEAM ADOCCURTEAM ON AU.CDOCCURMONITTEAM = ADOCCURTEAM.CDTEAM CROSS JOIN ( SELECT QTDAYS FROM ADMAILTASKEXEC WHERE CDMAILTASKEXEC = ( SELECT TASK.CDAHEAD FROM ADMAILTASKREL TASK WHERE TASK.CDMAILTASKREL = ( SELECT TBL.CDMAILTASKSETTINGS FROM CONOTIFICATION TBL)) ) AUXADMAILTASKEXEC WHERE AU.FGOCCURMONITORING = 1 AND AU.FGAUDITSTATUS = 56 AND P.FGSTATUS NOT IN (3, 4, 5) AND EXISTS( SELECT 1 FROM ADTEAMUSER WHERE ADTEAMUSER.CDUSER = <!%CDUSER%> AND ADTEAMUSER.CDTEAM = AU.CDOCCURMONITTEAM ) UNION SELECT GNACT.CDGENACTIVITY AS CODE, '#{100475}' AS NMOBJECT, CAST (CASE WHEN GNACT.FGSTATUS = 1 OR GNACT.FGSTATUS = 2 THEN CASE WHEN (GNACT.DTSTARTPLAN IS NOT NULL AND GNACT.DTSTARTPLAN < CONVERT(DATE, GETDATE())) THEN 3 WHEN (GNACT.DTSTARTPLAN IS NULL OR GNACT.DTSTARTPLAN >= CONVERT(DATE, GETDATE())) THEN 1 END WHEN GNACT.FGSTATUS = 3 OR GNACT.FGSTATUS = 13 THEN CASE WHEN (GNACT.DTSTART IS NULL) THEN CASE WHEN (GNACT.DTSTARTPLAN < CONVERT(DATE, GETDATE())) THEN 3 WHEN (GNACT.DTSTARTPLAN > ( SELECT DBO.SEF_DTEND_WK_DAYS_PERIOD(GETDATE(), 5, (CASE WHEN GNACT.CDACTIVITYOWNER IS NOT NULL THEN ( SELECT CDCALENDAR FROM GNACTIVITY WHERE CDGENACTIVITY = GNACT.CDACTIVITYOWNER) ELSE GNACT.CDCALENDAR END)))) THEN 1 ELSE 2 END WHEN (GNACT.DTSTART IS NOT NULL AND GNACT.DTFINISH IS NULL) THEN CASE WHEN (GNACT.DTFINISHPLAN < CONVERT(DATE, GETDATE())) THEN 3 WHEN (GNACT.DTFINISHPLAN > ( SELECT DBO.SEF_DTEND_WK_DAYS_PERIOD(GETDATE(), 5, (CASE WHEN GNACT.CDACTIVITYOWNER IS NOT NULL THEN ( SELECT CDCALENDAR FROM GNACTIVITY WHERE CDGENACTIVITY = GNACT.CDACTIVITYOWNER) ELSE GNACT.CDCALENDAR END)))) THEN 1 ELSE 2 END WHEN (GNACT.DTSTART IS NOT NULL AND GNACT.DTFINISH IS NOT NULL) THEN CASE WHEN (GNACT.DTFINISH <= GNACT.DTFINISHPLAN) THEN 1 WHEN (GNACT.DTFINISH > GNACT.DTFINISHPLAN) THEN 3 END END WHEN GNACT.FGSTATUS = 5 OR GNACT.FGSTATUS = 4 THEN CASE WHEN (GNACT.DTSTARTPLAN IS NULL OR GNACT.DTFINISH <= GNACT.DTFINISHPLAN) THEN 1 ELSE 3 END END AS INTEGER) AS FGDEADLINEOCCUR, CAST (CASE WHEN GNACT.FGSTATUS = 1 OR GNACT.FGSTATUS = 2 THEN CASE WHEN (GNACT.DTSTARTPLAN IS NOT NULL AND GNACT.DTSTARTPLAN < CONVERT(DATE, GETDATE())) THEN '#{100899}' WHEN (GNACT.DTSTARTPLAN IS NULL OR GNACT.DTSTARTPLAN >= CONVERT(DATE, GETDATE())) THEN '#{100900}' END WHEN GNACT.FGSTATUS = 3 OR GNACT.FGSTATUS = 13 THEN CASE WHEN (GNACT.DTSTART IS NULL) THEN CASE WHEN (GNACT.DTSTARTPLAN < CONVERT(DATE, GETDATE())) THEN '#{100899}' WHEN (GNACT.DTSTARTPLAN > ( SELECT DBO.SEF_DTEND_WK_DAYS_PERIOD(GETDATE(), 5, (CASE WHEN GNACT.CDACTIVITYOWNER IS NOT NULL THEN ( SELECT CDCALENDAR FROM GNACTIVITY WHERE CDGENACTIVITY = GNACT.CDACTIVITYOWNER) ELSE GNACT.CDCALENDAR END)))) THEN '#{100900}' ELSE '#{201639}' END WHEN (GNACT.DTSTART IS NOT NULL AND GNACT.DTFINISH IS NULL) THEN CASE WHEN (GNACT.DTFINISHPLAN < CONVERT(DATE, GETDATE())) THEN '#{100899}' WHEN (GNACT.DTFINISHPLAN > ( SELECT DBO.SEF_DTEND_WK_DAYS_PERIOD(GETDATE(), 5, (CASE WHEN GNACT.CDACTIVITYOWNER IS NOT NULL THEN ( SELECT CDCALENDAR FROM GNACTIVITY WHERE CDGENACTIVITY = GNACT.CDACTIVITYOWNER) ELSE GNACT.CDCALENDAR END)))) THEN '#{100900}' ELSE '#{201639}' END WHEN (GNACT.DTSTART IS NOT NULL AND GNACT.DTFINISH IS NOT NULL) THEN CASE WHEN (GNACT.DTFINISH <= GNACT.DTFINISHPLAN) THEN '#{100900}' WHEN (GNACT.DTFINISH > GNACT.DTFINISHPLAN) THEN '#{100899}' END END WHEN GNACT.FGSTATUS = 5 OR GNACT.FGSTATUS = 4 THEN CASE WHEN (GNACT.DTSTARTPLAN IS NULL OR GNACT.DTFINISH <= GNACT.DTFINISHPLAN) THEN '#{100900}' ELSE '#{100899}' END END AS VARCHAR(255)) AS NMDEADLINEOCCUR, AU.CDAUDIT FROM AUAUDIT AU INNER JOIN AUAUDITTYPE AUTP ON (AU.CDAUDITTYPE = AUTP.CDAUDITTYPE) INNER JOIN AUSCOPESTRUCT ON AU.CDSCOPEDEFINITION = AUSCOPESTRUCT.CDSCOPEDEFINITION INNER JOIN GNASSOCACTIONPLAN GNACTP ON AUSCOPESTRUCT.CDASSOC = GNACTP.CDASSOC INNER JOIN GNACTIVITY GNACT ON (GNACT.CDGENACTIVITY = GNACTP.CDACTIONPLAN) INNER JOIN GNACTIONPLAN GNACTPLAN ON (GNACT.CDGENACTIVITY = GNACTPLAN.CDGENACTIVITY) WHERE AU.FGOCCURMONITORING = 1 AND AU.FGAUDITSTATUS = 56 AND GNACT.FGSTATUS NOT IN (5, 6) AND EXISTS( SELECT 1 FROM ADTEAMUSER WHERE ADTEAMUSER.CDUSER = <!%CDUSER%> AND ADTEAMUSER.CDTEAM = AU.CDOCCURMONITTEAM ) UNION SELECT GNACT.CDGENACTIVITY AS CODE, '#{210804}' AS NMOBJECT, CAST (CASE WHEN GNACT.FGSTATUS = 1 OR GNACT.FGSTATUS = 2 THEN CASE WHEN (GNACT.DTSTARTPLAN IS NOT NULL AND GNACT.DTSTARTPLAN < CONVERT(DATE, GETDATE())) THEN 3 WHEN (GNACT.DTSTARTPLAN IS NULL OR GNACT.DTSTARTPLAN >= CONVERT(DATE, GETDATE())) THEN 1 END WHEN GNACT.FGSTATUS = 3 OR GNACT.FGSTATUS = 13 THEN CASE WHEN (GNACT.DTSTART IS NULL) THEN CASE WHEN (GNACT.DTSTARTPLAN < CONVERT(DATE, GETDATE())) THEN 3 WHEN (GNACT.DTSTARTPLAN > ( SELECT DBO.SEF_DTEND_WK_DAYS_PERIOD(GETDATE(), 5, (CASE WHEN GNACT.CDACTIVITYOWNER IS NOT NULL THEN ( SELECT CDCALENDAR FROM GNACTIVITY WHERE CDGENACTIVITY = GNACT.CDACTIVITYOWNER) ELSE GNACT.CDCALENDAR END)))) THEN 1 ELSE 2 END WHEN (GNACT.DTSTART IS NOT NULL AND GNACT.DTFINISH IS NULL) THEN CASE WHEN (GNACT.DTFINISHPLAN < CONVERT(DATE, GETDATE())) THEN 3 WHEN (GNACT.DTFINISHPLAN > ( SELECT DBO.SEF_DTEND_WK_DAYS_PERIOD(GETDATE(), 5, (CASE WHEN GNACT.CDACTIVITYOWNER IS NOT NULL THEN ( SELECT CDCALENDAR FROM GNACTIVITY WHERE CDGENACTIVITY = GNACT.CDACTIVITYOWNER) ELSE GNACT.CDCALENDAR END)))) THEN 1 ELSE 2 END WHEN (GNACT.DTSTART IS NOT NULL AND GNACT.DTFINISH IS NOT NULL) THEN CASE WHEN (GNACT.DTFINISH <= GNACT.DTFINISHPLAN) THEN 1 WHEN (GNACT.DTFINISH > GNACT.DTFINISHPLAN) THEN 3 END END WHEN GNACT.FGSTATUS = 5 OR GNACT.FGSTATUS = 4 THEN CASE WHEN (GNACT.DTSTARTPLAN IS NULL OR GNACT.DTFINISH <= GNACT.DTFINISHPLAN) THEN 1 ELSE 3 END END AS INTEGER) AS FGDEADLINEOCCUR, CAST (CASE WHEN GNACT.FGSTATUS = 1 OR GNACT.FGSTATUS = 2 THEN CASE WHEN (GNACT.DTSTARTPLAN IS NOT NULL AND GNACT.DTSTARTPLAN < CONVERT(DATE, GETDATE())) THEN '#{100899}' WHEN (GNACT.DTSTARTPLAN IS NULL OR GNACT.DTSTARTPLAN >= CONVERT(DATE, GETDATE())) THEN '#{100900}' END WHEN GNACT.FGSTATUS = 3 OR GNACT.FGSTATUS = 13 THEN CASE WHEN (GNACT.DTSTART IS NULL) THEN CASE WHEN (GNACT.DTSTARTPLAN < CONVERT(DATE, GETDATE())) THEN '#{100899}' WHEN (GNACT.DTSTARTPLAN > ( SELECT DBO.SEF_DTEND_WK_DAYS_PERIOD(GETDATE(), 5, (CASE WHEN GNACT.CDACTIVITYOWNER IS NOT NULL THEN ( SELECT CDCALENDAR FROM GNACTIVITY WHERE CDGENACTIVITY = GNACT.CDACTIVITYOWNER) ELSE GNACT.CDCALENDAR END)))) THEN '#{100900}' ELSE '#{201639}' END WHEN (GNACT.DTSTART IS NOT NULL AND GNACT.DTFINISH IS NULL) THEN CASE WHEN (GNACT.DTFINISHPLAN < CONVERT(DATE, GETDATE())) THEN '#{100899}' WHEN (GNACT.DTFINISHPLAN > ( SELECT DBO.SEF_DTEND_WK_DAYS_PERIOD(GETDATE(), 5, (CASE WHEN GNACT.CDACTIVITYOWNER IS NOT NULL THEN ( SELECT CDCALENDAR FROM GNACTIVITY WHERE CDGENACTIVITY = GNACT.CDACTIVITYOWNER) ELSE GNACT.CDCALENDAR END)))) THEN '#{100900}' ELSE '#{201639}' END WHEN (GNACT.DTSTART IS NOT NULL AND GNACT.DTFINISH IS NOT NULL) THEN CASE WHEN (GNACT.DTFINISH <= GNACT.DTFINISHPLAN) THEN '#{100900}' WHEN (GNACT.DTFINISH > GNACT.DTFINISHPLAN) THEN '#{100899}' END END WHEN GNACT.FGSTATUS = 5 OR GNACT.FGSTATUS = 4 THEN CASE WHEN (GNACT.DTSTARTPLAN IS NULL OR GNACT.DTFINISH <= GNACT.DTFINISHPLAN) THEN '#{100900}' ELSE '#{100899}' END END AS VARCHAR(255)) AS NMDEADLINEOCCUR, AU.CDAUDIT FROM AUAUDIT AU INNER JOIN AUAUDITTYPE AUTP ON (AU.CDAUDITTYPE = AUTP.CDAUDITTYPE) INNER JOIN AUSCOPESTRUCT ON AU.CDSCOPEDEFINITION = AUSCOPESTRUCT.CDSCOPEDEFINITION INNER JOIN GNASSOCACTIONPLAN GNACTP ON AUSCOPESTRUCT.CDASSOC = GNACTP.CDASSOC INNER JOIN GNACTIVITY GNACT ON (GNACT.CDGENACTIVITY = GNACTP.CDACTIONPLAN) INNER JOIN GNTASK GNTK ON (GNACT.CDGENACTIVITY = GNTK.CDGENACTIVITY) WHERE AU.FGOCCURMONITORING = 1 AND AU.FGAUDITSTATUS = 56 AND GNACT.FGSTATUS NOT IN (5, 6) AND GNACT.CDACTIVITYOWNER IS NULL AND EXISTS( SELECT 1 FROM ADTEAMUSER WHERE ADTEAMUSER.CDUSER = <!%CDUSER%> AND ADTEAMUSER.CDTEAM = AU.CDOCCURMONITTEAM ) ) OCCUR GROUP BY FGDEADLINEOCCUR, NMDEADLINEOCCUR, NMOBJECT