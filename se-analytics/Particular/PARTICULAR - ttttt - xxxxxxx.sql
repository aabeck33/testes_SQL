select distinct '_TRE' as idprocess, 'Treinamento' as nmprocess, ga.nmgroup as quem , case when ga.idgroup = 'TRE_ADMIN' then 'Gestor corporativo de treinamneto'        when ga.idgroup = 'TRE_ONLINE' then 'Partiipante em treinamentos online'        when ga.idgroup = 'TRE_GEST' then 'Gestor de treinamento'        when ga.idgroup = 'TRE_EXE' then 'Executor de treinamento'        when ga.idgroup = 'TRE_CONSA' then 'Consulta avançada de treinamentos'        when ga.idgroup = 'TRE_CONSB' then 'Consulta básica de treinamentos' end as acesso , '1' as tpacesso, ga.idgroup as idqq, ga.cdgroup as cdqq , usr.idlogin, usr.nmuser, usr.fguserenabled, pos.nmposition, dep.nmdepartment , adc.iddepartment +' - '+ adc.nmdepartment as unidade , 1 as qtd , substring((select cast(';' as nvarchar(max)) + cast(usrk.idlogin as varchar(max)) as [text()] from aduser usrk inner join aduserrole usrd on usrd.cduser = usrk.cduser inner join adrole role on role.cdrole = usrd.cdrole where role.idrole =  'SOL-ACESS_KEYUSERP-'+ case when substring(adc.iddepartment, 8, 5) = 'TDS' then 'AN' else substring(adc.iddepartment, 8, 5) end +'-TRE' for XML path('')), 2, 4000) as keyuser from aduser usr inner join aduseraccgroup gau on gau.cduser = usr.cduser inner join adaccessgroup ga on ga.cdgroup = gau.cdgroup and ga.cdgroup in (36,37,38,44,46,69) inner join aduserdeptpos rel on rel.cduser=usr.cduser and rel.FGDEFAULTDEPTPOS = 1 inner join addepartment dep on dep.cddepartment = rel.cddepartment inner join adposition pos on pos.cdposition = rel.cdposition inner join addepartment adc on adc.fgdepttype = 2 and adc.cddepartment = dep.cddeptowner where usr.fguserenabled = 1 union all select '_DOCUMENTOS_'+ categoria as idprocess, nmcat as nmprocess, quem, permissoes as acesso , tpacesso , (select case when (select idcategory from dccategory where cdcategory = ( select cdcategoryowner from dccategory where cdcategory = ( select cdcategoryowner from dccategory where cdcategory = (select cdcategoryowner from dccategory where idcategory = categoria)))) is not null then  (select idcategory from dccategory where cdcategory = ( select cdcategoryowner from dccategory where cdcategory = ( select cdcategoryowner from dccategory where cdcategory = (select cdcategoryowner from dccategory where idcategory = categoria)))) else case when (select idcategory from dccategory where cdcategory = ( select cdcategoryowner from dccategory where cdcategory = (select cdcategoryowner from dccategory where idcategory = categoria))) is not null then (select idcategory from dccategory where cdcategory = ( select cdcategoryowner from dccategory where cdcategory = (select cdcategoryowner from dccategory where idcategory = categoria))) else case when (select idcategory from dccategory where cdcategory = (select cdcategoryowner from dccategory where idcategory = categoria)) is not null then (select idcategory from dccategory where cdcategory = (select cdcategoryowner from dccategory where idcategory = categoria)) else categoria end end end from dccategory cat where cat.idcategory = categoria) as idqq , codeq as cdqq , usr.idlogin, usr.nmuser, usr.fguserenabled, dep.nmdepartment, pos.nmposition , adc.iddepartment +' - '+ adc.nmdepartment as unidade , 1 as qtd , substring((select cast(';' as nvarchar(max)) + cast(usrk.idlogin as varchar(max)) as [text()] from aduser usrk inner join aduserrole usrd on usrd.cduser = usrk.cduser inner join adrole role on role.cdrole = usrd.cdrole where role.idrole =  'SOL-ACESS_KEYUSERD-'+ categoria for XML path('')), 2, 4000) as keyuser from (select doc.FGPERMISSION as tpacesso 	, case doc.FGPERMISSION when 1 then 'Acesso concedido' when 2 then 'Acesso negado' end as tppermissao 	, case FGACCESSTYPE               when 1 then case when doc.cdteam is null then 'Outros' else	(select eq.IDTEAM + ' - ' + eq.NMTEAM from adteam eq where eq.cdteam = doc.cdteam) end               when 2 then (select dep.iddepartment +' - '+ dep.nmdepartment from addepartment dep where dep.cddepartment = doc.cddepartment)               when 3 then (select dep.iddepartment +' - '+ dep.nmdepartment from addepartment dep where dep.cddepartment = doc.cddepartment) +' | '+                   (select pos.idposition +' - '+ pos.nmposition from adposition pos where pos.cdposition = doc.cdposition)               when 4 then (select pos.idposition +' - '+ pos.nmposition from adposition pos where pos.cdposition = doc.cdposition)               when 5 then (select usr.idlogin +' - '+ usr.nmuser from aduser usr where usr.cduser = doc.cduser)               when 6 then 'Todos' 	end as Quem, doc.cdteam as codeq , cat.idcategory as categoria, cat.nmcategory as nmcat , cat.idcategory, doc.CDACCESSROLE , cast ((select substring(__sub.__permissoes, 2, 4000) as [text()] from (         select case dcc.FGACCESSADD when 1 then '|Incluir' else '' end         + case dcc.FGACCESSEDIT when 1 then '|Alterar' else '' end         + case dcc.FGACCESSDELETE when 1 then '|Excluir' else '' end         + case dcc.FGACCESSKNOW when 1 then '|Conhecimento' else '' end         + case dcc.FGACCESSTRAIN when 1 then '|Treinamento' else '' end         + case dcc.FGACCESSVIEW when 1 then '|Visualizar' else '' end         + case dcc.FGACCESSPRINT when 1 then '|Imprimir' else '' end         + case dcc.FGACCESSPHYSFILE when 1 then '|Arquivar' else '' end         + case dcc.FGACCESSREVISION when 1 then '|Revisar' else '' end         + case dcc.FGACCESSCOPY when 1 then '|Distribuir cópia' else '' end         + case dcc.FGACCESSREGTRAIN when 1 then '|Registrar treinamento'  else '' end         + case dcc.FGACCESSCANCEL when 1 then '|Cancelar' else '' end         + case dcc.FGACCESSSAVE when 1 then '|Salvar localmente' else '' end         + case dcc.FGACCESSSIGN when 1 then '|Assinatura' else '' end         + case dcc.FGACCESSNOTIFY when 1 then '|Notificação' else '' end         + case dcc.FGACCESSEDITKNOW when 1 then '|Avaliar aplicabilidade' else '' end         + case dcc.FGACCESSADDCOMMENT when 1 then '|Incluir comentário' else '' end as __permissoes from DCCATEGORYDOCROLE dcc where dcc.CDACCESSROLE = doc.CDACCESSROLE) __sub for XML path('')) as varchar(4000)) as permissoes from DCCATEGORYDOCROLE doc inner join dccategory cat on cat.CDCATEGORY = doc.CDCATEGORY and cat.fgenabled = 1 where 1 = 1 ) sub inner join adteammember equ on equ.cdteam = sub.codeq inner join aduser usr on equ.cduser = usr.cduser inner join aduserdeptpos rel on rel.cduser = usr.cduser and rel.fgdefaultdeptpos = 1 inner join addepartment dep on dep.cddepartment = rel.cddepartment inner join adposition pos on pos.cdposition = rel.cdposition inner join addepartment adc on adc.fgdepttype = 2 and adc.cddepartment = dep.cddeptowner where  (codeq <> 00 or codeq is null) union all select _sub.*, usr.idlogin, usr.nmuser, usr.fguserenabled, pos.nmposition, dep.nmdepartment, adc.iddepartment +' - '+ adc.nmdepartment as unidade , 1 as qtd , substring((select cast(';' as nvarchar(max)) + cast(usrk.idlogin as varchar(max)) as [text()] from aduser usrk inner join aduserrole usrd on usrd.cduser = usrk.cduser inner join adrole role on role.cdrole = usrd.cdrole where role.idrole =  'SOL-ACESS_KEYUSERP-'+ idprocess for XML path('')), 2, 4000) as keyuser from ( /* Lista de Roles */ select distinct pmap.idactivity as idprocess, pmap.nmactivity as nmprocess , adr.idrole +' - '+ adr.nmrole as quem, 'Papel Funcional' as acesso , 1 as tpacesso , adr.idrole as idqq, adr.cdrole as cdqq from pmprocess pmp inner join pmstruct pms on pms.cdproc = pmp.cdproc inner join pmactivity pma on pms.cdactivity = pma.cdactivity inner join pmactivity pmap on pmap.cdactivity = pms.cdproc inner join adrole adr on adr.cdrole = pms.cdrole where pmp.fgprocenabled = 1 and pms.fgtype = 1 and pms.fgexecutortype = 1 and pms.cdrevision = (select max(cdrevision) from pmstruct where cdproc = pmp.cdproc) and pma.fgsystemactivity <> 1 and pmap.fgstatus < 3 and pmap.idactivity in  ( 'tds-cm', 'in-cm', 'sg-cm', 'ua-cm'                         , 'tds-de', 'in-de', 'sg-de', 'ua-de'                         , 'tds-eq', 'in-eq', 'sg-eq', 'ua-qe'                         , 'tds-sol', 'in-sol', 'sg-sol', 'ua-req'                         , 'tds-lab', 'in-lab', 'sg-lab', 'ua-lab'                         , 'tds-rm', 'in-rm', 'sg-rm', 'ua-cc'                         , 'GQ-ACESSO', 'UA-SFTINC', 'UA-SFTOBS'                         , 'DHO-MEP', 'DHO-MEPC', 'DHO-STE', 'ITSM-INCSOL'                         ) union all /* Papeis funcionais do MEP */ select distinct pmap.idactivity as idprocess, pmap.nmactivity as nmprocess , adr.idrole +' - '+ adr.nmrole as quem, 'Papel Funcional' as acesso , 1 as tpacesso , adr.idrole as idqq, adr.cdrole as cdqq from pmprocess pmp inner join pmstruct pms on pms.cdproc = pmp.cdproc inner join pmactivity pma on pms.cdactivity = pma.cdactivity inner join pmactivity pmap on pmap.cdactivity = pms.cdproc inner join (select * from adrole) adr on adr.cdroleowner in (select cdrole from adrole where cdroleowner = (select cdrole from adrole where idrole = 'DHO-MEP')) where pmp.fgprocenabled = 1 and pms.fgtype = 1 and pms.fgexecutortype = 1 and pms.cdrevision = (select max(cdrevision) from pmstruct where cdproc = pmp.cdproc) and pma.fgsystemactivity <> 1 and pmap.fgstatus < 3 and (pmap.idactivity = 'DHO-MEP' or pmap.idactivity = 'DHO-MEPC') union all /* Possíveis gestores de contrato */ select distinct pmap.idactivity as idprocess, pmap.nmactivity as nmprocess , adr.idrole +' - '+ adr.nmrole as quem, 'Papel Funcional' as acesso , 1 as tpacesso , adr.idrole as idqq, adr.cdrole as cdqq from pmprocess pmp inner join pmstruct pms on pms.cdproc = pmp.cdproc inner join pmactivity pma on pms.cdactivity = pma.cdactivity inner join pmactivity pmap on pmap.cdactivity = pms.cdproc inner join adrole adr on adr.cdrole = (select cdrole from adrole where idrole = 'JUR-GERCON_SENIORS') where pmp.fgprocenabled = 1 and pms.fgtype = 1 and pms.fgexecutortype = 1 and pms.cdrevision = (select max(cdrevision) from pmstruct where cdproc = pmp.cdproc) and pma.fgsystemactivity <> 1 and pmap.fgstatus < 3 and pmap.idactivity like 'JUR-GERCON%' and pmap.idactivity  in  ( 'tds-cm', 'in-cm', 'sg-cm', 'ua-cm'                         , 'tds-de', 'in-de', 'sg-de', 'ua-de'                         , 'tds-eq', 'in-eq', 'sg-eq', 'ua-qe'                         , 'tds-sol', 'in-sol', 'sg-sol', 'ua-req'                         , 'tds-lab', 'in-lab', 'sg-lab', 'ua-lab'                         , 'tds-rm', 'in-rm', 'sg-rm', 'ua-cc'                         , 'GQ-ACESSO', 'UA-SFTINC', 'UA-SFTOBS'                         , 'DHO-MEP', 'DHO-MEPC', 'DHO-STE', 'ITSM-INCSOL'                         ) union all /* Aprovadores GQ-ACESSO */ select distinct pmap.idactivity as idprocess, pmap.nmactivity as nmprocess , adr.idrole +' - '+ adr.nmrole as quem, 'Aprovação VSC' as acesso , 1 as tpacesso , adr.idrole as idqq, adr.cdrole as cdqq from pmprocess pmp inner join pmstruct pms on pms.cdproc = pmp.cdproc inner join pmactivity pma on pms.cdactivity = pma.cdactivity inner join pmactivity pmap on pmap.cdactivity = pms.cdproc inner join (Select * from DYNuq055) adro on adro.ac004 is not null inner join adrole adr on adr.idrole = adro.ac004 where pmp.fgprocenabled = 1 and pms.fgtype = 1 and pms.fgexecutortype = 4 and pms.cdrevision = (select max(cdrevision) from pmstruct where cdproc = pmp.cdproc) and pma.fgsystemactivity <> 1 and pmap.fgstatus < 3 and pmap.idactivity = 'GQ-ACESSO' union all select distinct pmap.idactivity as idprocess, pmap.nmactivity as nmprocess , adr.idrole +' - '+ adr.nmrole as quem, 'Aprovação Técnica' as acesso , 1 as tpacesso , adr.idrole as idqq, adr.cdrole as cdqq from pmprocess pmp inner join pmstruct pms on pms.cdproc = pmp.cdproc inner join pmactivity pma on pms.cdactivity = pma.cdactivity inner join pmactivity pmap on pmap.cdactivity = pms.cdproc inner join (Select * from DYNuq055) adro on adro.ac004 is not null inner join adrole adr on (adr.idrole = adro.ac002 or adr.idrole = adro.ac005) where pmp.fgprocenabled = 1 and pms.fgtype = 1 and pms.fgexecutortype = 4 and pms.cdrevision = (select max(cdrevision) from pmstruct where cdproc = pmp.cdproc) and pma.fgsystemactivity <> 1 and pmap.fgstatus < 3 and pmap.idactivity = 'GQ-ACESSO' union all select distinct pmap.idactivity as idprocess, pmap.nmactivity as nmprocess , adr.idrole +' - '+ adr.nmrole as quem, 'Operador do Sistema' as acesso , 1 as tpacesso , adr.idrole as idqq, adr.cdrole as cdqq from pmprocess pmp inner join pmstruct pms on pms.cdproc = pmp.cdproc inner join pmactivity pma on pms.cdactivity = pma.cdactivity inner join pmactivity pmap on pmap.cdactivity = pms.cdproc inner join (Select * from DYNuq055) adro on adro.ac004 is not null inner join adrole adr on adr.idrole = adro.ac003 where pmp.fgprocenabled = 1 and pms.fgtype = 1 and pms.fgexecutortype = 4 and pms.cdrevision = (select max(cdrevision) from pmstruct where cdproc = pmp.cdproc) and pma.fgsystemactivity <> 1 and pmap.fgstatus < 3 and pmap.idactivity = 'GQ-ACESSO' union all /* Aprovadores de CM */ select distinct pmap.idactivity as idprocess, pmap.nmactivity as nmprocess , adr.idrole +' - '+ adr.nmrole as quem, 'Papel Funcional' as acesso , 1 as tpacesso , adr.idrole as idqq, adr.cdrole as cdqq from pmprocess pmp inner join pmstruct pms on pms.cdproc = pmp.cdproc inner join pmactivity pma on pms.cdactivity = pma.cdactivity inner join pmactivity pmap on pmap.cdactivity = pms.cdproc inner join adrole adr on adr.cdrole in (select cdrole from adrole where cdroleowner in (select cdrole from adrole where substring(idrole, charindex('-', idrole), len(idrole)) = '-CM_APR')) where pmp.fgprocenabled = 1 and pms.fgtype = 1 and pms.fgexecutortype = 1 and pms.cdrevision = (select max(cdrevision) from pmstruct where cdproc = pmp.cdproc) and pma.fgsystemactivity <> 1 and pmap.fgstatus < 3 and pmap.idactivity like '__-cm' and adr.idrole like case when pmap.idactivity = 'tds-cm' then 'an-cm_apr-%' else substring(pmap.idactivity, 1, 2) +'-cm_apr-%' end union all /* Investigadores de DE */ select distinct pmap.idactivity as idprocess, pmap.nmactivity as nmprocess , adr.idrole +' - '+ adr.nmrole as quem, 'Papel Funcional' as acesso , 1 as tpacesso , adr.idrole as idqq, adr.cdrole as cdqq from pmprocess pmp inner join pmstruct pms on pms.cdproc = pmp.cdproc inner join pmactivity pma on pms.cdactivity = pma.cdactivity inner join pmactivity pmap on pmap.cdactivity = pms.cdproc inner join adrole adr on adr.cdrole in (select cdrole from adrole where substring(idrole, charindex('-', idrole), len(idrole)) = '-DE_INV') where pmp.fgprocenabled = 1 and pms.fgtype = 1 and pms.fgexecutortype = 1 and pms.cdrevision = (select max(cdrevision) from pmstruct where cdproc = pmp.cdproc) and pma.fgsystemactivity <> 1 and pmap.fgstatus < 3 and (pmap.idactivity = '__-qe' or pmap.idactivity = '__-eq') and adr.idrole like case when pmap.idactivity = 'tds-de' then 'an-de_inv' else substring(pmap.idactivity, 1, 2) +'-de_inv' end union all /* Gestores */ select pmap.idactivity as idprocess, pmap.nmactivity as nmprocess , adr.idrole +' - '+ adr.nmrole as quem, 'Gestor do processo' as acesso , 1 as tpacesso , adr.idrole as idqq, adr.cdrole as cdqq from pmprocess pmp inner join pmactivity pmap on pmap.cdactivity = pmp.cdproc inner join adrole adr on adr.cdrole = pmp.CDROLEMANAGER where pmp.fgprocenabled = 1 and pmap.fgstatus < 3 and pmap.idactivity  in  ( 'tds-cm', 'in-cm', 'sg-cm', 'ua-cm'                         , 'tds-de', 'in-de', 'sg-de', 'ua-de'                         , 'tds-eq', 'in-eq', 'sg-eq', 'ua-qe'                         , 'tds-sol', 'in-sol', 'sg-sol', 'ua-req'                         , 'tds-lab', 'in-lab', 'sg-lab', 'ua-lab'                         , 'tds-rm', 'in-rm', 'sg-rm', 'ua-cc'                         , 'GQ-ACESSO', 'UA-SFTINC', 'UA-SFTOBS'                         , 'DHO-MEP', 'DHO-MEPC', 'DHO-STE', 'ITSM-INCSOL'                         ) union all /* Segurança do processo */ select pmap.idactivity as idprocess, pmap.nmactivity as nmprocess , qqq.qqnm as quem , substring((select ' | '+ NMACCESSROLEFIELD as [text()] from PMPROCSECURITYCTRL pmps1 inner join PMACCESSROLEFIELD pmpsn1 on pmpsn1.cdACCESSROLEFIELD = pmps1.cdACCESSROLEFIELD and pmpsn1.FGOBJECTTYPE > 0 where pmps1.cdproc = pmpac.cdproc and pmps1.cdaccesslist = pmpac.cdaccesslist for XML path('')), 4, 4000) as acesso, pmpac.FGPERMISSION as tpacesso , substring(qqq.qqnm, 1, charindex(' ', qqq.qqnm)) as idqq , case when pmpac.cdteam is null then pmpac.cdrole else pmpac.cdteam end as cdqq from pmprocess pmp inner join pmactivity pmap on pmap.cdactivity = pmp.cdproc inner join PMPROCACCESSLIST pmpac on pmpac.cdproc = pmp.cdproc inner join (select pmp1.cdproc, case when pmpac1.cdteam is null then (select idrole +' - '+ nmrole from adrole where cdrole = pmpac1.cdrole) else (select idteam +' - '+ nmteam from adteam where cdteam = pmpac1.cdteam) end qqnm             , case when pmpac1.cdteam is null then pmpac1.cdrole else pmpac1.cdteam end qqcd             from pmprocess pmp1 inner join PMPROCACCESSLIST pmpac1 on pmpac1.cdproc = pmp1.cdproc) qqq on qqq.cdproc = pmp.cdproc and qqq.qqcd = case when pmpac.cdteam is null then pmpac.cdrole else pmpac.cdteam end where pmp.fgprocenabled = 1 and pmap.fgstatus < 3 and pmpac.fgpermission = 1 and (pmpac.cdteam <> 00 or pmpac.cdteam is null) and pmap.idactivity  in  ( 'tds-cm', 'in-cm', 'sg-cm', 'ua-cm'                         , 'tds-de', 'in-de', 'sg-de', 'ua-de'                         , 'tds-eq', 'in-eq', 'sg-eq', 'ua-qe'                         , 'tds-sol', 'in-sol', 'sg-sol', 'ua-req'                         , 'tds-lab', 'in-lab', 'sg-lab', 'ua-lab'                         , 'tds-rm', 'in-rm', 'sg-rm', 'ua-cc'                         , 'GQ-ACESSO', 'UA-SFTINC', 'UA-SFTOBS'                         , 'DHO-MEP', 'DHO-MEPC', 'DHO-STE', 'ITSM-INCSOL'                         ) union all /* Aprovadores e Responsáveis de EQ */ select distinct pmap.idactivity as idprocess, pmap.nmactivity as nmprocess , case when (pmap.idactivity = 'tds-eq' or pmap.idactivity = 'in-eq' or pmap.idactivity = 'sg-eq') then 'Lista QUA-009'         when (pmap.idactivity = 'ua-qe') then 'List QUA-031' else 'NA' end as quem , case when (pmap.idactivity = 'tds-eq' or pmap.idactivity = 'in-eq' or pmap.idactivity = 'sg-eq') then 'Aprovador Indicado'         when (pmap.idactivity = 'ua-qe') then 'Approver' else 'NA' end as acesso , 1 as tpacesso , case when (pmap.idactivity = 'tds-eq' or pmap.idactivity = 'in-eq' or pmap.idactivity = 'sg-eq') then 'QUA-009'         when (pmap.idactivity = 'ua-qe') then 'QUA-031' else 'NA' end as idqq , case when (pmap.idactivity = 'tds-eq' or pmap.idactivity = 'in-eq' or pmap.idactivity = 'sg-eq') then (select cdattribute from adattribute where nmattribute = 'QUA-009')        when (pmap.idactivity = 'ua-qe') then (select cdattribute from adattribute where nmattribute = 'QUA-031') else 0 end as cdqq from pmprocess pmp inner join pmstruct pms on pms.cdproc = pmp.cdproc inner join pmactivity pma on pms.cdactivity = pma.cdactivity inner join pmactivity pmap on pmap.cdactivity = pms.cdproc where pmp.fgprocenabled = 1 and pms.fgtype = 1 and pms.fgexecutortype = 1 and pms.cdrevision = (select max(cdrevision) from pmstruct where cdproc = pmp.cdproc) and pma.fgsystemactivity <> 1 and pmap.fgstatus < 3 and (substring(pmap.idactivity, charindex('-', pmap.idactivity), len(pmap.idactivity)) = '-qe' or substring(pmap.idactivity, charindex('-', pmap.idactivity), len(pmap.idactivity)) = '-eq') union all select distinct pmap.idactivity as idprocess, pmap.nmactivity as nmprocess , case when (pmap.idactivity = 'tds-eq') then 'Lista QUA-012'        when (pmap.idactivity = 'in-eq') then 'Lista QUA-023'        when (pmap.idactivity = 'sg-eq') then 'Lista QUA-041'        when (pmap.idactivity = 'ua-qe') then 'List QUA-034' else 'NA' end as quem , case when (pmap.idactivity = 'tds-eq' or pmap.idactivity = 'in-eq') then 'Responsável pelo Evento de Qualidade'        when (pmap.idactivity = 'ua-qe') then 'Quality Event Responsible' else 'NA' end as acesso , 1 as tpacesso , case when (pmap.idactivity = 'tds-eq') then 'QUA-012'        when (pmap.idactivity = 'in-eq') then 'QUA-023'        when (pmap.idactivity = 'sg-eq') then 'Lista QUA-041'        when (pmap.idactivity = 'ua-qe') then 'QUA-034' else 'NA' end as idqq , case when (pmap.idactivity = 'tds-eq') then (select cdattribute from adattribute where nmattribute = 'QUA-012')        when (pmap.idactivity = 'in-eq') then (select cdattribute from adattribute where nmattribute = 'QUA-023')        when (pmap.idactivity = 'sg-eq') then (select cdattribute from adattribute where nmattribute = 'QUA-041')        when (pmap.idactivity = 'ua-qe') then (select cdattribute from adattribute where nmattribute = 'QUA-034') else 0 end as cdqq from pmprocess pmp inner join pmstruct pms on pms.cdproc = pmp.cdproc inner join pmactivity pma on pms.cdactivity = pma.cdactivity inner join pmactivity pmap on pmap.cdactivity = pms.cdproc where pmp.fgprocenabled = 1 and pms.fgtype = 1 and pms.fgexecutortype = 1 and pms.cdrevision = (select max(cdrevision) from pmstruct where cdproc = pmp.cdproc) and pma.fgsystemactivity <> 1 and pmap.fgstatus < 3 and (pmap.idactivity = '__-qe' or pmap.idactivity = '__-eq') union all /* Lilsta de Aprovadores (Sistema/Area) GQ-Acesso */ select distinct pmap.idactivity as idprocess, pmap.nmactivity as nmprocess , 'Lista - DYNuq057 - AC003' as quem, 'Aprovação - Responsável pelo Sistema/Área' as acesso , 1 as tpacesso , 'DYN057' as idqq, 3 as cdqq from pmprocess pmp inner join pmstruct pms on pms.cdproc = pmp.cdproc inner join pmactivity pma on pms.cdactivity = pma.cdactivity inner join pmactivity pmap on pmap.cdactivity = pms.cdproc where pmp.fgprocenabled = 1 and pms.fgtype = 1 and pms.fgexecutortype = 4 and pms.cdrevision = (select max(cdrevision) from pmstruct where cdproc = pmp.cdproc) and pma.fgsystemactivity <> 1 and pmap.fgstatus < 3 and pmap.idactivity = 'GQ-ACESSO' ) _sub inner join (select teamm.cdteam as cdqq, idteam as idqq, cduser from adteammember teamm inner join adteam team on team.cdteam = teamm.cdteam             union all select rolem.cdrole as cdqq, idrole as idqq, cduser from aduserrole rolem inner join adrole rolek on rolek.cdrole = rolem.cdrole             union all select distinct 3 as cdqq, 'DYNuq057' as idqq, (select cduser from aduser where nmuser = form.ac003) as cduser from DYNuq057 form           ) rel on rel.cdqq = _sub.cdqq and rel.idqq = _sub.idqq inner join aduser usr on usr.cduser = rel.cduser inner join aduserdeptpos relu on relu.cduser = rel.cduser and FGDEFAULTDEPTPOS = 1 inner join addepartment dep on dep.cddepartment = relu.cddepartment inner join adposition pos on pos.cdposition = relu.cdposition inner join addepartment adc on adc.fgdepttype = 2 and adc.cddepartment = dep.cddeptowner